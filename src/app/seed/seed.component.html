<h2>Admin Seed</h2>
<section class="admin-card" aria-labelledby="seed-title">
  <header class="admin-card-header">
    <div class="brand">
      <div class="brand-head">
        <!-- small Pokéball SVG -->
        <svg class="pokeball" viewBox="0 0 100 100" width="36" height="36" aria-hidden="true" focusable="false">
          <circle cx="50" cy="50" r="48" fill="#e63946" stroke="#000" stroke-width="4"></circle>
          <path d="M2 50h96" stroke="#000" stroke-width="8" />
          <circle cx="50" cy="50" r="18" fill="#fff" stroke="#000" stroke-width="4"></circle>
          <circle cx="50" cy="50" r="8" fill="#000"></circle>
        </svg>
        <h1 id="seed-title">Admin — Seed Pokémon Data</h1>
      </div>
      <p class="lead">Manage the Pokémon dataset used by the app. Use these actions carefully.</p>
    </div>
  </header>

  <div class="status" role="status" aria-live="polite">
    <div *ngIf="loading()" class="status-row">
      <span class="spinner" aria-hidden="true"></span>
      <span>Checking dataset status…</span>
    </div>

    <div *ngIf="!loading() && seeded() === true" class="status-row seeded">
      <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true"><path fill="#2b9348" d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"/></svg>
      <div class="status-text">
        <strong>Data seeded</strong>
        <p class="muted">Pokémon data is already present. To reseed, delete all data then seed again.</p>
      </div>
    </div>

    <div *ngIf="!loading() && seeded() === false" class="status-row not-seeded">
      <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true"><path fill="#ffb703" d="M12 2L2 22h20L12 2z"/></svg>
      <div class="status-text">
        <strong>Data not seeded</strong>
        <p class="muted">No Pokémon data found. Click the button below to seed the data.</p>
      </div>
    </div>

    <div *ngIf="error()" class="status-row error" role="alert">{{ error() }}</div>
    <div *ngIf="message()" class="status-row message" role="status">{{ message() }}</div>
  </div>

  <div class="actions">
    <button
      class="btn btn-primary"
      type="button"
      (click)="seed()"
      [disabled]="processing()"
      [attr.aria-busy]="processing()"
      aria-label="Seed Pokémon data"
    >
      <span *ngIf="!processing()">Seed Pokémon Data</span>
      <span *ngIf="processing()">Processing…</span>
    </button>

    <button
      *ngIf="seeded()"
      class="btn btn-danger"
      type="button"
      (click)="deleteAllAndSeed()"
      [disabled]="processing()"
      [attr.aria-busy]="processing()"
      aria-label="Delete all Pokémon and seed again"
    >
      Delete All & Seed Again
    </button>

    <button class="btn btn-ghost" type="button" (click)="checkSeedStatus()" aria-label="Refresh status">
      Refresh Status
    </button>
  </div>
</section>

<!-- Pokémon Meta Management -->
<section class="meta-section" aria-labelledby="meta-title">
  <header class="meta-header">
    <h2 id="meta-title">Pokémon Meta</h2>
    <p class="meta-lead">Browse and edit Pokémon metadata. Use filters to narrow results.</p>
  </header>

  <div class="meta-filters">
    <input type="text" placeholder="Search name or ID" class="filter-input" [value]="filterSearch()" (input)="filterSearch.set($any($event.target).value)" aria-label="Search" />

    <input type="number" placeholder="Generation" class="filter-input" [value]="filterGeneration()" (input)="filterGeneration.set($any($event.target).value ? +$any($event.target).value : null)" aria-label="Generation" />

    <select class="filter-input" [value]="filterRarity()" (change)="filterRarity.set($any($event.target).value ? +$any($event.target).value : null)" aria-label="Rarity">
      <option value="">All</option>
      <option *ngFor="let r of rarityOptions" [value]="r.value">{{ r.label }}</option>
    </select>

    <select class="filter-input" [value]="pageSize()" (change)="pageSize.set(+($any($event.target).value))" aria-label="Page size">
      <option value="10">10</option>
      <option value="20">20</option>
      <option value="50">50</option>
    </select>

    <button class="btn btn-ghost" type="button" (click)="reloadList()">Search</button>
    <button class="btn btn-ghost" type="button" (click)="resetFilters()">Reset</button>
  </div>

  <div class="meta-list" tabindex="0" (scroll)="onScroll($any($event.target))" role="list">
    <div class="meta-grid meta-grid-header" role="row">
      <div class="col id-col">ID</div>
      <div class="col name-col">Name</div>
      <div class="col gen-col">Generation</div>
      <div class="col rarity-col">Rarity</div>
      <div class="col stats-col">Base Stats</div>
      <div class="col actions-col">Actions</div>
    </div>

    <div *ngFor="let p of pokemonList(); trackBy: trackById" class="meta-row" role="listitem">
      <div class="col id-col">{{ p.id }}</div>
      <div class="col name-col">{{ p.name }}</div>

      <div class="col gen-col">
        <div *ngIf="editingId() !== p.id">{{ p.generationId }}</div>
        <div *ngIf="editingId() === p.id">
          <input type="number" [(ngModel)]="$any(p)._tmpGenerationId" name="tmpGeneration-{{p.id}}" />
        </div>
      </div>

      <div class="col rarity-col">
        <div *ngIf="editingId() !== p.id">{{ rarityLabel(p.rarity) }}</div>
        <div *ngIf="editingId() === p.id">
          <select [(ngModel)]="$any(p)._tmpRarity" name="tmpRarity-{{p.id}}">
            <option [ngValue]="null">-- select rarity --</option>
            <option *ngFor="let r of rarityOptions" [ngValue]="r.value">{{ r.label }}</option>
          </select>
        </div>
      </div>

      <div class="col stats-col">
        <div *ngIf="editingId() !== p.id">
          <pre class="stats-pre">{{ p.baseStatTotal | json }}</pre>
        </div>
        <div *ngIf="editingId() === p.id">
          <input class="stats-input" type="number" [(ngModel)]="$any(p)._tmpBaseStats" name="tmpBaseStats-{{p.id}}" aria-label="Base stats total" />
        </div>
      </div>

      <div class="col actions-col">
        <button *ngIf="editingId() !== p.id" class="icon-btn" title="Edit" (click)="startEdit(p)">✏️</button>
        <div *ngIf="editingId() === p.id">
          <button class="btn btn-primary" (click)="saveEdit(p)" [disabled]="savingId() === p.id">Save</button>
          <button class="btn" (click)="cancelEdit()">Cancel</button>
        </div>
      </div>
    </div>

    <div *ngIf="loadingList()" class="list-loading">Loading…</div>
    <div *ngIf="!loadingList() && !pokemonList().length" class="list-empty">No results</div>
  </div>
</section>